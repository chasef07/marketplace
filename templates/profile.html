{% extends "base.html" %}

{% block title %}My Profile{% endblock %}

{% block content %}
<div class="profile-page">
    <h2>üë§ My Profile</h2>
    
    <div class="user-info">
        <div class="card">
            <h3>Account Information</h3>
            <p><strong>Username:</strong> {{ current_user.username }}</p>
            <p><strong>Email:</strong> {{ current_user.email }}</p>
            <p><strong>Member since:</strong> {{ current_user.created_at.strftime('%B %d, %Y') }}</p>
        </div>
        
        <div class="card">
            <h3>ü§ñ AI Personalities</h3>
            <p><strong>Seller AI:</strong> {{ current_user.seller_personality.replace('_', ' ').title() }}</p>
            <p><strong>Buyer AI:</strong> {{ current_user.buyer_personality.replace('_', ' ').title() }}</p>
            <a href="{{ url_for('main.settings') }}" class="btn btn-primary btn-sm">Change Settings</a>
        </div>
    </div>
    
    <div class="profile-section">
        <h3>üì¶ My Listings ({{ user_items|length }})</h3>
        
        {% if user_items %}
        <div class="items-grid">
            {% for item in user_items %}
            <div class="card item-card">
                {% if item.image_path %}
                <img src="{{ url_for('static', filename='uploads/' + item.image_path) }}" alt="{{ item.name }}" class="item-image">
                {% endif %}
                <h4>{{ item.name }}</h4>
                <p><strong>Price:</strong> ${{ item.starting_price }} (min: ${{ item.min_price }})</p>
                <p><strong>Condition:</strong> {{ item.condition.title() }}</p>
                <p><strong>Type:</strong> {{ item.furniture_type.value.replace('_', ' ').title() }}</p>
                <p><small>Listed {{ item.created_at.strftime('%Y-%m-%d') }}</small></p>
                
                {% if item.is_sold %}
                <span class="badge sold">SOLD</span>
                {% else %}
                <div class="item-actions">
                    <a href="{{ url_for('main.view_item', item_id=item.id) }}" class="btn btn-primary btn-sm">View</a>
                    <form method="POST" action="{{ url_for('main.delete_item', item_id=item.id) }}" style="display: inline;">
                        <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure?')">Delete</button>
                    </form>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="card">
            <p>You haven't created any listings yet. <a href="{{ url_for('main.create_listing') }}">Create your first listing!</a></p>
        </div>
        {% endif %}
    </div>
    
    <div class="profile-section">
        <h3>ü§ù My Negotiations ({{ negotiations|length }})</h3>
        
        {% if negotiations %}
        <div class="negotiations-list">
            {% for negotiation in negotiations %}
            <div class="card negotiation-card">
                <div class="negotiation-header">
                    <h4>{{ negotiation.item.name }}</h4>
                    <span class="status-badge {{ negotiation.status.value }}">
                        {{ negotiation.status.value.replace('_', ' ').title() }}
                    </span>
                </div>
                
                <div class="negotiation-details">
                    <p><strong>Role:</strong> 
                        {% if negotiation.seller_id == current_user.id %}
                        Seller
                        {% else %}
                        Buyer
                        {% endif %}
                    </p>
                    
                    <p><strong>Other Party:</strong> 
                        {% if negotiation.seller_id == current_user.id %}
                        {{ negotiation.buyer.username }}
                        {% else %}
                        {{ negotiation.seller.username }}
                        {% endif %}
                    </p>
                    
                    <p><strong>Current Offer:</strong> ${{ negotiation.current_offer }}</p>
                    <p><strong>Round:</strong> {{ negotiation.round_number }}/{{ negotiation.max_rounds }}</p>
                    <p><small>Started {{ negotiation.created_at.strftime('%Y-%m-%d %H:%M') }}</small></p>
                </div>
                
                <div class="negotiation-actions">
                    <a href="{{ url_for('main.view_negotiation', negotiation_id=negotiation.id) }}" class="btn btn-primary btn-sm">
                        View Details
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="card">
            <p>You haven't started any negotiations yet. Browse items to start negotiating!</p>
        </div>
        {% endif %}
    </div>
</div>

<style>
.profile-section {
    margin: 30px 0;
}

.items-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
    margin-top: 15px;
}

.item-card {
    position: relative;
}

.item-image {
    width: 100%;
    height: 150px;
    object-fit: cover;
    border-radius: 4px;
    margin-bottom: 10px;
}

.item-actions {
    margin-top: 10px;
    display: flex;
    gap: 10px;
}

.badge {
    position: absolute;
    top: 10px;
    right: 10px;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: bold;
}

.badge.sold {
    background: #dc3545;
    color: white;
}

.negotiations-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-top: 15px;
}

.negotiation-card {
    padding: 20px;
}

.negotiation-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.negotiation-header h4 {
    margin: 0;
}

.status-badge {
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: bold;
    text-transform: uppercase;
}

.status-badge.active {
    background: #17a2b8;
    color: white;
}

.status-badge.completed {
    background: #28a745;
    color: white;
}

.status-badge.cancelled {
    background: #6c757d;
    color: white;
}

.negotiation-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 10px;
    margin-bottom: 15px;
}

.negotiation-details p {
    margin: 5px 0;
}

.btn-sm {
    padding: 4px 8px;
    font-size: 12px;
}
</style>
{% endblock %}