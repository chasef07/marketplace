{% extends "base.html" %}

{% block title %}Negotiate for {{ item.name }}{% endblock %}

{% block content %}
<div class="negotiate-page">
    <h2>ü§ù Negotiate for {{ item.name }}</h2>
    
    <div class="item-summary">
        <div class="item-info">
            {% if item.image_path %}
            <img src="{{ url_for('static', filename='uploads/' + item.image_path) }}" alt="{{ item.name }}" class="item-thumbnail">
            {% endif %}
            <div class="item-details">
                <h3>{{ item.name }}</h3>
                <p><strong>Asking Price:</strong> ${{ item.starting_price }}</p>
                <p><strong>Condition:</strong> {{ item.condition.title() }}</p>
                <p><strong>Seller:</strong> {{ item.owner.username }}</p>
            </div>
        </div>
    </div>
    
    {% if existing_negotiation %}
    <div class="card existing-negotiation">
        <h4>‚ö†Ô∏è You already have an active negotiation for this item</h4>
        <p><strong>Current Offer:</strong> ${{ existing_negotiation.current_offer }}</p>
        <p><strong>Round:</strong> {{ existing_negotiation.round_number }}/{{ existing_negotiation.max_rounds }}</p>
        <a href="{{ url_for('main.view_negotiation', negotiation_id=existing_negotiation.id) }}" class="btn btn-primary">View Negotiation</a>
    </div>
    {% else %}
    <div class="card">
        <h4>üí∞ Make Your Initial Offer</h4>
        <p>Start negotiating with the seller. Make your best offer below:</p>
        
        <form method="POST" action="{{ url_for('main.start_negotiation') }}">
            <input type="hidden" name="item_id" value="{{ item.id }}">
            
            <div class="form-group">
                <label for="initial_offer">Your Offer ($):</label>
                <input type="number" 
                       id="initial_offer" 
                       name="initial_offer" 
                       step="0.01" 
                       min="1" 
                       max="{{ item.starting_price }}"
                       placeholder="{{ (item.starting_price * 0.8)|round(2) }}" 
                       required>
                <small class="form-text">Maximum: ${{ item.starting_price }}</small>
            </div>
            
            <div class="form-group">
                <button type="submit" class="btn btn-success">ü§ù Start Negotiation</button>
                <a href="{{ url_for('main.view_item', item_id=item.id) }}" class="btn">Cancel</a>
            </div>
        </form>
    </div>
    {% endif %}
    
    <div class="negotiation-info">
        <h4>‚ÑπÔ∏è How Negotiation Works</h4>
        <ul>
            <li>Make your initial offer below the asking price</li>
            <li>The AI seller will respond with a counteroffer</li>
            <li>Continue negotiating until you reach an agreement</li>
            <li>Maximum 10 rounds per negotiation</li>
            <li>Either party can accept an offer to complete the deal</li>
        </ul>
    </div>
</div>

<style>
.item-summary {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 20px;
}

.item-info {
    display: flex;
    gap: 15px;
    align-items: center;
}

.item-thumbnail {
    width: 100px;
    height: 100px;
    object-fit: cover;
    border-radius: 8px;
}

.item-details h3 {
    margin: 0 0 10px 0;
}

.item-details p {
    margin: 5px 0;
}

.existing-negotiation {
    background: #fff3cd;
    border: 1px solid #ffeaa7;
}

.negotiation-info {
    background: #e7f3ff;
    padding: 20px;
    border-radius: 8px;
    margin-top: 20px;
}

.negotiation-info ul {
    margin: 10px 0;
    padding-left: 20px;
}

.negotiation-info li {
    margin: 5px 0;
}

.form-text {
    color: #666;
    font-size: 0.85em;
}
</style>
{% endblock %}